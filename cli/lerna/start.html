<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="application-name" content="微笑"><meta name="apple-mobile-web-app-title" content="微笑"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#3eaf7c"><title>lerna5.x 入门 | 微笑的博客</title><meta name="description" content="私人博客">
    <link rel="preload" href="/assets/js/runtime~app.fd38288b.js" as="script"><link rel="preload" href="/assets/css/styles.d59fa427.css" as="style"><link rel="preload" href="/assets/js/540.6e361f5b.js" as="script"><link rel="preload" href="/assets/js/app.37d27266.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.d59fa427.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">微笑的博客</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/vue/" class="nav-link" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/study/" class="nav-link" aria-label="体系学习"><!--[--><!--]--> 体系学习 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/react/react1" class="nav-link" aria-label="react"><!--[--><!--]--> react <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/node/" class="nav-link" aria-label="node"><!--[--><!--]--> node <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/git/git1" class="nav-link" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/cli/" class="nav-link router-link-active" aria-label="CLI"><!--[--><!--]--> CLI <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/js/js1" class="nav-link" aria-label="js"><!--[--><!--]--> js <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/about/" class="nav-link" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/audition/js/auditionJs1.md" class="nav-link" aria-label="面试&amp;总结"><!--[--><!--]--> 面试&amp;总结 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/notes/2022" class="nav-link" aria-label="日记"><!--[--><!--]--> 日记 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/vue/" class="nav-link" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/study/" class="nav-link" aria-label="体系学习"><!--[--><!--]--> 体系学习 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/react/react1" class="nav-link" aria-label="react"><!--[--><!--]--> react <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/node/" class="nav-link" aria-label="node"><!--[--><!--]--> node <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/git/git1" class="nav-link" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/cli/" class="nav-link router-link-active" aria-label="CLI"><!--[--><!--]--> CLI <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/js/js1" class="nav-link" aria-label="js"><!--[--><!--]--> js <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/about/" class="nav-link" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/audition/js/auditionJs1.md" class="nav-link" aria-label="面试&amp;总结"><!--[--><!--]--> 面试&amp;总结 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/notes/2022" class="nav-link" aria-label="日记"><!--[--><!--]--> 日记 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/cli/" class="nav-link router-link-active sidebar-heading sidebar-item active" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/cli/lerna/start.md" class="nav-link sidebar-item active" aria-label="lerna"><!--[--><!--]--> lerna <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cli/lerna/start.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="lerna5.x 入门"><!--[--><!--]--> lerna5.x 入门 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cli/lerna/start.html#简介" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="简介"><!--[--><!--]--> 简介 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/cli/lerna/start.html#优势" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="优势"><!--[--><!--]--> 优势 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cli/lerna/start.html#lerna-管理模式" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="lerna 管理模式"><!--[--><!--]--> lerna 管理模式 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cli/lerna/start.html#安装" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/cli/lerna/start.html#命令" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="命令"><!--[--><!--]--> 命令 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="lerna5-x-入门" tabindex="-1"><a class="header-anchor" href="#lerna5-x-入门" aria-hidden="true">#</a> lerna5.x 入门</h1><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h2><blockquote><p><code>Lerna 是用于 TypeScript/JavaScript 的原始 monorepo 工具。它已经存在多年，被数以万计的项目使用，包括 React、Jest 和 Babel。</code></p></blockquote><p>它解决了 JavaScript monorepos 的三个最大问题：</p><ul><li><p>Lerna 在 repo 中链接不同的项目，因此它们可以相互导入，而无需向 NPM 发布任何内容。</p></li><li><p>Lerna 对任意数量的项目运行命令，它以最有效的方式、以正确的顺序执行它，并且可以将其分布在多台机器上。</p></li><li><p>Lerna 管理您的发布过程，从版本管理到发布再到 NPM，它提供了多种选项来确保可以适应任何工作流程。</p></li></ul><hr><h3 id="优势" tabindex="-1"><a class="header-anchor" href="#优势" aria-hidden="true">#</a> 优势</h3><ul><li>大幅减少重复操作</li><li>提升操作的标准化</li></ul><hr><h3 id="lerna-管理模式" tabindex="-1"><a class="header-anchor" href="#lerna-管理模式" aria-hidden="true">#</a> lerna 管理模式</h3><p>lerna 管理项目可以使用两种模式，默认固定模式，当使用 lerna init -i 命令初始化项目时，此时为独立模式</p><ul><li>固定模式：所有包使用同一个版本</li><li>独立模式：给每个包单独设置版本号</li></ul><blockquote><p>可以将lerna.json 中的 <code>version</code> 设置为 <code>Independent</code> 改变成独立模式。默认是统一的版本号</p></blockquote><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h2><ol><li>全局安装 Lerna</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">npm i lerna -g
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>本地安装</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">  mkdir xxx &amp;&amp; </span><span style="color:#DCDCAA;">cd</span><span style="color:#D4D4D4;"> xxx </span></span>
<span class="line"><span style="color:#D4D4D4;">  npm init </span></span>
<span class="line"><span style="color:#D4D4D4;">  npm i lerna -D</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>初始化</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;"> lerna init</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="命令" tabindex="-1"><a class="header-anchor" href="#命令" aria-hidden="true">#</a> 命令</h2><ol><li><code>lerna init</code> 将一个仓库初始化为一个lerna仓库，或升级现有的lerna版本到当前安装的版本</li></ol><blockquote><p>--independent/-i – 使用独立的版本控制模式</p></blockquote><ol start="2"><li><p><code>lerna create</code> 创建一个 package 到项目工程的 packages 下</p></li><li><p><code>lerna add</code> 安装包</p><ul><li>没有参数，在根目录安装包，所有模块都可引用</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">lerna add babel</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>可以匹配给那些包安装</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">lerna add module-1 packages/prefix-*</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><code>--scope</code> 安装的包还是在根node_module,只是配置只会z增加到当前的package.json中</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">lerna add module-1 --scope=module-2</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><code>--dev</code> 安装到devDependencies</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">lerna add module-1 --scope=module-2 --dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p><code>lerna bootstrap</code> 将本地包链接在一起并安装剩余的包依赖项</p></li><li><p><code>lerna clean</code> 从所有包中删除 node_modules 目录，但不会删除根目录的node_module。只会删除 node_modules，不会删除 package.json 中的依赖</p></li><li><p><code>lerna link</code> 链接互相引用的库，当 package/package.json 内明确了 packages 下的包时，才会将相关包链接到 package/node_modules 中。</p></li><li><p><code>lerna list</code> 列出所有的包的信息</p></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">lerna list = lerna ls</span></span>
<span class="line"><span style="color:#D4D4D4;">lerna ll</span></span>
<span class="line"><span style="color:#D4D4D4;">lerna la</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="8"><li><p><code>lerna changed</code> 列出所有改动的包</p></li><li><p><code>lerna diff</code> 列出所有或单个包的差异</p></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">$ lerna diff</span></span>
<span class="line"><span style="color:#6A9955;"># 指定看某个模块的差异</span></span>
<span class="line"><span style="color:#D4D4D4;">$ lerna diff package-name</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="10"><li><p><code>lerna run</code> 运行每个包下面的 script命令</p></li><li><p><code>lerna exec</code> 执行 shell 脚本</p></li><li><p><code>lerna info</code> 查看 lerna 及运行环境的信息</p></li><li><p><code>lerna publish</code> 发布包</p></li></ol><ul><li>发布时会自动执行：git add package-lock.json，所以 package-lock.json 不要加入 .gitignore</li><li>先创建远程仓库，并且同步一次 master 分支</li><li>执行 lerna publish 前先完成 npm login，登录的时候要先检查npm源地址，要切换到https://registry.npmjs.org/</li><li>如果发布的 npm 包名为：@xxx/yyy 的格式，需要先在 npm 注册名为：xxx 的 organization，否则可能会提交不成功</li><li>发布到 npm group 时默认为 private，所以我们需要手动在 package.json 中添加如下配置：</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#CE9178;">&quot;publishConfig&quot;</span><span style="color:#D4D4D4;">: {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;access&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;public&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2022/9/24 12:59:57</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1083732908@qq.com">shangxin</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.fd38288b.js" defer></script><script src="/assets/js/540.6e361f5b.js" defer></script><script src="/assets/js/app.37d27266.js" defer></script>
  </body>
</html>
